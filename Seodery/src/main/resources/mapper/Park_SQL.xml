<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="park">

	<!-- 댓글목록 조회 -->
 	  <select id="getPDList" parameterType="hashmap" resultType="hashmap">
		SELECT COMM_NUM,MBER_NUM,PARK_NUM,SRATING,CON,to_char(WRDATE,'YYYY-MM-DD')AS DT,
				ROW_NUMBER()  OVER(ORDER BY COMM_NUM DESC) AS PNUM 
                FROM PC
                where park_num =#{no}
                and delc = 1
	</select> 
 

	<!-- 댓글 목록 총 건수조회 -->
	  <select id="getPDCnt" parameterType="hashmap" resultType="Integer">
		select count(*) as cnt
		from PC
		WHERE PARK_NUM = #{no}
		and delc = 1
	</select>  

<!-- 공원 테이블에 공원번호, 공원이름, 주소, 번호 insert -->
	<insert id="addPK" parameterType="hashmap">
		 INSERT INTO PK(PARK_NUM, PARK_NM, AREA, TEL_NUM)
		VALUES (#{no}, #{name}, #{addr}, #{phon})
	</insert>

<!-- 댓글 인서트  -->
	<insert id="addP" parameterType="hashmap">
		 INSERT INTO PC(COMM_NUM,MBER_NUM,PARK_NUM,SRATING,CON,WRDATE)
		VALUES (PC_SEQ.nextval,#{mo},#{no},#{srating},#{con},SYSDATE)
	</insert> 
	
	<!-- 공원 테이블에 내가 선택한 공원 번호가 없으면 y 있으면 n  -->
	 <select id="getParkNumIsExists" parameterType="hashmap" resultType="String">
		SELECT ( 
		    CASE WHEN EXISTS ( SELECT PARK_NUM FROM PK 
		                        WHERE PARK_NUM = #{no} ) 
		      THEN 'Y' ELSE 'N' END ) AS IS_EXISTS 
		FROM DUAL
	</select> 
	
	<!-- 내가 선택한 공원정보 공원테이블에 업데이트 -->
	<update id="updateP" parameterType="hashmap">
		update PK set PARK_NM = #{name}, AREA = #{addr}, TEL_NUM = #{phon}
		where PARK_NUM = #{no}
	</update>
	
	<!-- 댓글 내용 업데이트 -->
	<update id="updatePCON" parameterType="hashmap">
		update PC set con=#{con}
		where  COMM_NUM= #{Cnum}
	</update>
	
	<!-- 댓글 삭제 -->
	<update id="deletePCON" parameterType="hashmap">
	 update pc set DELC = 0
	where COMM_NUM = #{Cnum}
	</update>
	
</mapper>